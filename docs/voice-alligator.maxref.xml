<?xml version='1.0' encoding='utf-8' standalone='yes'?>


<!-- DO NOT EDIT THIS FILE ... YOU WILL LOSE YOUR WORK -->


<c74object name='voice-alligator' category='velocities,  pitches,  etc.'>

	<digest>voice allocator for poly~ object </digest>


<description>
		<b>voice-alligator</b> is an external that manages voice allocation. It is designed to work with the <o>poly~</o> object and offers several additional features compared to the built-in voice allocation system.
		<br/><br/>
		The primary focus is to allow all settings of voice-alligator to be adjusted on the fly while maintaining coherent and intuitive behavior. The differences from <o>poly~</o>'s voice allocation are best demonstrated through musical demos, which can be found in the <openfilelink filename="voice-alligator-overview.maxpat">Overview Patch</openfilelink>.
		<br/><br/>
		Features:
		<br/><br/>
			&#160;&#160;&#160;&#160;- Switch between monophony and polyphony while playing.
			<br/>
			&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<i>(see demos 1-mono and 2-monoAndHold).</i><br/>
			&#160;&#160;&#160;&#160;- A Fast and easy scale definition format for alternative scales/microtonal tunings.<br/>
			&#160;&#160;&#160;&#160;- Differentiate between notes with higher and lower priority on different "streams". <br/>
			&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<i>(see demo 8-notePriorities)</i><br/>
			&#160;&#160;&#160;&#160;- "Hold" notes: notes that stay sustained after key de-press, end/release them at a later time.<br/> 
			&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<i>(see demo 3-portamentoAndHold)</i><br/>
			&#160;&#160;&#160;&#160;- Remember pitches during scale changes. <br/>
			&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<i>(see demo 5-scale).</i><br/>
			&#160;&#160;&#160;&#160;- Treat notes of different kinds or streams differently, e.g. regarding parameter changes. <br/>
			&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<i>(see demo 4-holdAndPitchwheel)</i><br/>
			&#160;&#160;&#160;&#160;- Record pitches instead of MIDI notes for playback after scale changes.<br/>
			&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<i>(see demo 6-noteLooper and 7-noteLooper2)</i><br/>

</description>

<discussion>  
		<br/>
		<i><b>Inlet 1 - Queueing a Note</b></i>
		<br/><br/>
		The full message syntax for queueing a single note is as follows:<br/><br/>
		&#160;&#160;&#160;&#160;&#160;<m>midipitch, velocity, (stream), (monoflag), (realpitch)</m><br/>
		<i>
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;float&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;float
		</i>
		<br/><br/>
		The first two arguments are required, while the remaining arguments are optional.
		<br/><br/>
		<b>The third argument (stream):</b>
		<br/><br/> 
		This specifies the priority of the note. By default, notes on stream <i>n</i> cannot steal notes from stream with a higher number (higher number means lower priority with regards to stealing). Monophony is applied to one stream at a time, so we can play two or more portamento melodies on different streams simultaneously. If no stream was provided, stream 1 is chosen.
		<br/><br/>
		<b>The fourth argument (monoflag):</b>
		<br/><br/>
		When provided, this argument treats the incoming note as a <i>Sequencer Note.</i>
		<br/><br/>
		<i>Sequencer Notes</i> could originate from note-generating sources, such as the Note Looper or a sequencer, and are designed to allow the player to play over them. They ignore <m>mono</m>, <m>hold</m>, <m>sustain</m>, and <m>mono_note_priority</m> settings but are still affected by <m>mono_steals_release</m>.
		<br/><br/>
		<b>The fifth argument (realpitch):</b>
		<br/><br/>
		When provided, this treats the incoming note as a <i>Pre-recorded Note.</i>
		<br/><br/>
		<i>Pre-recorded Notes</i> are notes that were previously recorded after being processed by voice-alligator. Since they have a predefined pitch, they bypass the frequency lookup in voice-alligator. 
		<br/>
		Like Sequencer Notes, they ignore <m>mono</m>, <m>hold</m>, <m>sustain</m>, and <m>mono_note_priority</m> settings but are still affected by <m>mono_steals_release</m>.
		<br/><br/><br/>

		<i><b>Inlet 2</b></i>
		<br/><br/>
		Message consisting of:
		<br/><br/>
		&#160;&#160;&#160;&#160;&#160;<m>target, muteflag</m>
		<br/>
		<i>
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool
		</i>
		<br/><br/>
		This message is generated by a <o>thispoly~</o> in the voice patcher and informs voice-alligator that the release phase of the ADSR of that voice has ended and that the voice is now mute (muteflag 1) and therefore available for any new, incoming note.
		<br/><br/><br/>

		<i><b>Outlet -- connected to <o>poly~</o> or <o>voice-alligator-looper</o></b></i>
		<br/><br/>
		For each event, voice-alligator will output 2 separate messages. The order of these messages is always the same.
		<br/><br/>
		<u>First message:</u>
		<br/><br/>
		&#160;&#160;&#160;&#160;&#160;<m>"target", target</m>
		<br/>
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int
		<br/><br/>
		

		This tells poly~ which voice instance the next messages will be directed to, until a new target is set.

		<br/><br/>
		<u>Second message:</u>
		<br/><br/>
		&#160;&#160;&#160;&#160;&#160;<m>"notes", pitch, vel, "flags", glide, hold, sustain, sequencer, mono, stream</m>
		<br/>
		<i>
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;float
		&#160;&#160;&#160;&#160;&#160;float
		&#160;&#160;&#160;&#160;&#160;&#160;string
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool
		&#160;&#160;&#160;&#160;&#160;&#160;bool
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int
		</i>
		<br/><br/>

		Everything after "flags" can be used for different purposes in the voice (see comments in  <openfilelink filename="alligator-example-voice.maxpat">alligator-example-voice</openfilelink>) and you could get really creative with these i.e. having different parameter settings per stream, or glide notes not retriggering a pitch envelope etc. There is an example of one type of alternative usage of flags in the <openfilelink filename="alligator-advanced-voice-tutorial.maxpat">alligator-advanced-voice-tutorial</openfilelink>.
		<br/><br/>

		Depending on the attribute <m>output_mode</m> the pitch will either be a frequency in Hertz as float or a MIDI note as integer (ignoring scale definitions).
		<br/><br/>
		Not every event has the<m>"notes"</m> part of the message. If you release a key while <m>hold</m> or <m>sustain</m> is on, the note off will be ignored. In this case the voice is still informed that the status of the note has changed, but it will not receive a pitch/velocity pair, only flags. The message will look like this: 
		<br/><br/>
		&#160;&#160;&#160;&#160;&#160;<m>"flags", glide, hold, sustain, sequencer, mono, stream</m>
		<br/>
		<i>
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bool
		&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;int
		</i>
		<br/><br/>
		This type of event is also ignored by our  <openfilelink filename="voice-alligator-looper.maxhelp">Note Looper</openfilelink>. The Note Looper automatically ends all notes after each iteration, so hold / sustain notes that were started but not ended during recording will be automatically ended anyway.
		<br/><br/>
	
</discussion>

	<!--METADATA-->

	<metadatalist>
		<metadata name='author'>Jan Godde, Edis Ludwig </metadata>
		<metadata name='tag'>velocities</metadata>
		<metadata name='tag'>pitches</metadata>
		<metadata name='tag'>etc.</metadata>
	</metadatalist>


	<!--ARGUMENTS-->

	<objarglist>

		<objarg name='voices' optional='1' type='int'>
			<digest>Number of voices, max: 1024 </digest>
			<description>Number of voices
				<br/>
				Maximum: 1024 
				<br/>
				Default: 1
				<br/>
				<br/>
				The number of voices must match the first argument of the controlled <o>poly~</o> object.
			</description>
		</objarg>

	</objarglist>


	<!--MESSAGES-->

	<methodlist>

		<method name='end'>
			<digest>Sends Notes into release</digest>
			<description>
				Sends Notes into release.
				<br/><br/>
				<m>end</m> will send all notes into release
				<br/>
				<m>end <i>$1</i></m> will send notes of stream <i>$1</i> into release.
			</description>
		</method>

		<method name='endhold'>
			<digest>End hold notes.</digest>
			<description> Releases all hold notes when called with <m>endhold</m>, ends the youngest note that was put into hold with <m>endhold first</m> or the oldest with <m>endhold last</m>.</description>
		</method>

		<method name='scale_def'>
			<digest> Defines the internal tuning of voice-alligator </digest>
			<description> A <m>scale_def</m> message is a single, long message that assigns pitches to MIDI keys. 
				<br/><br/>
				For further information see tab <i>Microtonality</i> in the <openfilelink filename="voice-alligator.maxhelp"> help-patcher</openfilelink>.
			</description>
		</method>

		<method name='voices'>
			<digest>Sets the number of voices </digest>
			<description>
				<m>voices <i>$1</i></m> sets the number of voices to <i>$1</i>. This will make voice-alligator output the message <m>voices <i>$1</i></m> to <o>poly~</o>.
				<br/><br/>
				It is still advised to set the voices as arguments to voice-alligator and poly~, but this was included for convenience.
			</description>
		</method>

		<method name='printscale'>
			<digest>Print contents of the internal scale array to the max console</digest>
			<description>Prints contents of scale_array to the max console, either in floating point midi when called with <m>printscale</m> or in hertz when called with <m>printscale freq</m>.
			</description>
		</method>


		<method name='print'>
			<digest>Print info about internal note storage to max console</digest>
			<description> 
				Print info about the internal note storage of voice-alligator to max console.
				<br/><br/>
				This is primarily for debugging. </description>
		</method>

	</methodlist>


	<!--ATTRIBUTES-->

	<attributelist>

		<attribute name='active' get='1' set='1' type='bool' size='1' >
			<digest>Activates note processing (default true) </digest>
			<description>
				Activates note processing
				<br/><br/>
				<m>active 1</m> will activate Note-On processing for all streams.
				<br/>
				<m>active 1 <i>$1</i></m> will activate Note-On processing for stream <i>$1</i>.
				<br />
				<br />
				Note-Off processing will still happen when active is set to 0. 
				<br />
				<br />
				<i>default: true</i>
			</description>
		</attribute>

		<attribute name='sustain' get='1' set='1' type='bool' size='1' >
			<digest>Sustain on/off </digest>
			<description>Sustain on/off 
				<br/>
				<br/>
				If <m>sustain</m> is on:
				<br/>
				Note-On: play a normal Note-On.
				<br/>
				Note-Off: send a flags message informing the voice instance of poly~ that it is a sustain note, and don't release the note.
				<br/><br/>
				A voice will go into sustain or hold when it receives a Note-Off. When both are enabled, sustain is preferred.
				<br/><br/>
				<i>default: false</i>
			</description>
		</attribute>


		<attribute name='hold' get='1' set='1' type='bool' size='1' >
			<digest>Hold on/off </digest>
			<description>
				Hold is the same as <m>sustain</m> except that turning hold off will not automatically release all notes. To release notes that are in hold use the <m>endhold</m> message. 
				<br/>
				<br/>
				If <m>hold</m> is on:
				<br/>
				Note-On: play a normal Note-On.
				<br/>
				Note-Off: send a flags message informing the voice that it is a hold note, and don't release the note.
				<br/>
				<br/>
				<i>default: false</i>
			</description>
		</attribute>

		<attribute name='mono' get='1' set='1' type='bool' size='1' >
			<digest>Monophony on/off </digest>
			<description>Monophony on/off 
				<br/><br/>
				All Note-ons after turning on monophony will be mono notes. 
				<br/><br/>
				Monophony allows portamento playing, so when you release a note A and another monophonic note B is still pressed, the synth will glide to note B. 
				<br/><br/>
				<i>"glide" and "portamento" is used interchangeably in this reference.</i>
				<br/><br/>
				<i>default: false</i>

				<br/><br/>
				Glide notes (i.e., notes that are not the first note in a portamento sequence) carry a special flag. This flag can be used for different purposes. 
				The first and most important thing is telling the <o>line~</o> object in the voice, that is driving the pitch of our oscillator, to perform a glide. Also, it will set the <o>adsr~</o> object in the  <openfilelink filename="alligator-example-voice.maxpat">example-voice</openfilelink> to "legato_mode", meaning it won't perform a declick, even though it got a new note while the envelope wasn't finished.
				The voice also has a parameter called glide_retrigger, which will decide if the amplitude ADSR is retriggered when a glide note is played. Other ADSRs or modulations could also be exempt from retriggering.
			</description>
			
		</attribute>

		<attribute name='mono_note_priority' get='1' set='1' type='int' size='1' >
			<digest>Mono Mode: 0 last, 1 low, 2 high (default last) </digest>
			<description>
				
				Enables retro-style monophonic behaviour.

				<ul class="simple">
				<li><m>0</m>: Last - All Note ons/offs cause pitch changes.</li>
				<li><m>1</m>: Low - Only new notes that are <b>below</b> the current <b>lowest</b> note cause pitch changes.</li>
				<li><m>2</m>: High - Only new notes that are <b>above</b> the current <b>highest</b> note cause pitch changes.</li>
				</ul>
				<i>default: 0 (Last)</i>

			</description>
		</attribute>

		<attribute name='mono_steals_release' get='1' set='1' type='bool' size='1' >
			<digest>If true a monophonic note that is in release will glide on a note on. </digest>
			<description> 
				What happens when a monophony note A is in release and a new note B is played?


				<ul class="simple">
				<li><m>0</m>: Note B sounds on a new voice, A is unaffected</li>
				<li><m>1</m>: Note B "steals" note A, and produces a glide pitch change.</li>
				</ul>
				<i>default: false</i>

			</description>
		</attribute>

		<attribute name='steal' get='1' set='1' type='bool' size='1' >
			<digest>Steal on/off (default true) </digest>
			<description> Enables voice stealing.
				<br/><br/>
				<i>default: true</i>
			</description>
		</attribute>

		<attribute name='steal_hold' get='1' set='1' type='bool' size='1' >
			<digest> Sets whether hold notes can be stolen (default true) </digest>
			<description> By setting this attribute to <m>0</m> we can exempt hold notes from being stolen. They will always sound until voice-alligator gets a <m>endhold</m> message. 
			<br/><br/>
				<i>default: true</i>
			</description>
		</attribute>

		<attribute name='respect_stream_priorities' get='1' set='1' type='int' size='1' >
			<digest>Don't respect streams, 1 Respect streams, 2 Respect streams but steal (default 1) </digest>
			<description>
				
				Sets the voice stealing mode with regard to streams.

				<ul class="simple">
				<li><m>0</m>: Don't respect streams at all, always steal oldest note.</li>
				<li><m>1</m>: Respect streams, notes from stream <i>n</i> can't steal notes from stream &lt;<i>n</i>.</li>
				<li><m>2</m>: Notes from stream <i>n</i> can steal notes from stream &lt;<i>n</i>, but will first try to steal of lower priority stream.</li>
				</ul>
				<i>default: 1</i>
			</description>
		</attribute>

		<attribute name='output_mode' get='1' set='1' type='bool' size='1' >
			<digest>Output Mode. 0: midi or 1: frequency (default frequency) </digest>
			<description>
				<m>output_mode</m> determines if voice-alligator will output MIDI pitches <m>0</m> or frequencies <m>1</m> to the voice. 
				<m>output_mode 0</m>can be useful for samplers.
				<br/><br/>
				
				<i>All microtonal scale definitions as well as the <m>basefreq</m> attribute will be ignored if <m>output_mode</m> is MIDI pitch.</i>
				<br/><br/>
				<i>default: 1 (Frequency)</i>
			</description>
		</attribute>

		<attribute name='scale_def_mode' get='1' set='1' type='bool' size='1' >
			<digest>Scale Definition Mode: 0: midi or 1: frequency (default frequency) </digest>
				<description>
				Chooses how the pitch of scale_def messages will be interpreted; either as MIDI value (<m>0</m>) or frequency (<m>1</m>). 
				<br/><br/>
				<i>default: 1 (Frequency)</i>
			</description>
		</attribute>

		<attribute name='scale_fill' get='1' set='1' type='bool' size='1' >
			<digest>Fill notes that are non-defined in scale_def message with MTOF (default true) </digest>
			<description> If a scale_def message doesn't contain all index/value pairs to cover all the pitches, this attribute determines whether missing indexes will get standard MTOF values. <m>scalearray_maxsize</m> will determine how many indexes need to be filled.
			<br/><br/>
				<i>default: true</i>
			</description>
		</attribute>

		<attribute name='scalearray_maxsize' get='1' set='1' type='int' size='1' >
			<digest>Set maximum number of entries in scale array (default 128) </digest>
			<description>Set maximum number of entries in scale array 
				<br/><br/>
				<i>default: 128</i> </description>
		</attribute>

		<attribute name='basefreq' get='1' set='1' type='float' size='1' >
			<digest>Standard A (default 440.0 hz)</digest>
			<description>
				Standard A
				<br/><br/>
				<i>default: 440.0</i>
			</description>
		</attribute>

		<attribute name='debug' get='1' set='1' type='bool' size='1' >
			<digest>Debug on/off </digest>
			<description> 
				Debug on/off
				<br/><br/>
				If you encounter bugs (most commonly hanging notes), please report them in the <a class="reference external" href="https://cycling74.com/forums/voice-alligator-v100-release">forum thread</a> and include a minimal reproducible patch. 
				
				<br/><br/>
				You can also make feature requests in the thread.
			</description>
		</attribute>

	</attributelist>


	<!--RELATED-->

	<seealsolist>
		<seealso name='poly~' />
	</seealsolist>

</c74object>
